<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MP4Parser: Welcom to MP4Parser</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MP4Parser
   &#160;<span id="projectnumber">V1.0.0</span>
   </div>
   <div id="projectbrief">A project to parse mp4 file.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Welcom to MP4Parser </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Synopsis</h3>
<p>MP4Parser can read raw data from a mp4 file, then parse out mp4 box in compliance of ISO_IEC_14496-12_2004(E). It will store all the boxes in a list, and provide a series of function so that you can easily find the box you instersted in. It also can output all the box information to stdout or file with beauty style. Finally, it's very easy to add new mp4 box to MP4Parser module.</p>
<p>Until now MP4Parser support the following mp4 boxes:</p><ul>
<li>audio_sample_entry_box</li>
<li>mfhdbox</li>
<li>stypbox</li>
<li>tfdtbox</li>
<li>tkhdbox</li>
<li>mehdbox</li>
<li>mvhdbox</li>
<li>tfhdbox</li>
<li>namebox</li>
<li>cttsbox</li>
<li>nmhdbox</li>
<li>tmaxbox</li>
<li>dimmbox</li>
<li>npckbox</li>
<li>tminbox</li>
<li>dmaxbox</li>
<li>numpbox</li>
<li>totlbox</li>
<li>dmedbox</li>
<li>paytbox</li>
<li>tpaybox</li>
<li>drefbox</li>
<li>pmaxbox</li>
<li>tpylbox</li>
<li>drepbox</li>
<li>rtpbox</li>
<li>tref_typebox</li>
<li>elstbox</li>
<li>sample_entry_box</li>
<li>trexbox</li>
<li>ftypbox</li>
<li>sdpbox</li>
<li>trpybox</li>
<li>hdlrbox</li>
<li>smhdbox</li>
<li>trunbox</li>
<li>hint_sample_entry_box</li>
<li>stcobox</li>
<li>urlbox</li>
<li>hmhdbox</li>
<li>stscbox</li>
<li>sttsbox</li>
<li>maxrbox</li>
<li>stsdbox</li>
<li>visual_sample_entry_box</li>
<li>mdatbox</li>
<li>stssbox</li>
<li>vmhdbox</li>
<li>mdhdbox</li>
<li>stszbox <h3>How to use MP4Parser</h3>
</li>
</ul>
<p><b>1. Transfer the box list:</b></p>
<p>**(1).Use your own transfer funciton:** </p><div class="fragment"><div class="line">void TransferBox(const BoxPtr_t &amp;box)</div><div class="line">{</div><div class="line">    //do something;</div><div class="line"></div><div class="line">    if (!box-&gt;hasChildren())</div><div class="line">    {</div><div class="line">        return;</div><div class="line">    }</div><div class="line"></div><div class="line">    BoxPtr_t child = box-&gt;firstChild();</div><div class="line">    while (child)</div><div class="line">    {</div><div class="line">        TransferBox(child);</div><div class="line">        child = child-&gt;nextSibling();</div><div class="line">    }</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">int main()</div><div class="line">{   </div><div class="line">    MP4Parser mp4Parser;</div><div class="line">    mp4Parser.parse(&quot;/your/mp4file/path/file.mp4&quot;);</div><div class="line">    </div><div class="line">    BoxPtr_t box = mp4Parser.getFirstBox();</div><div class="line">    while(box)</div><div class="line">    {</div><div class="line">        TransferBox(box);</div><div class="line">        box = box-&gt;nextSibling();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>**(2).Use MP4Parser's transfer function:** </p><div class="fragment"><div class="line">int TransferFunc(BoxPtr_t&amp; box, void *p_userData)</div><div class="line">{</div><div class="line">    int count = 0;</div><div class="line">    if (strcmp(box-&gt;type(), mp4Parser::BoxFactory::MOOV_BOX) == 0)</div><div class="line">    {</div><div class="line">        count++;</div><div class="line">    }</div><div class="line">    </div><div class="line">    int *p_count = static_cast&lt;int*&gt;p_userData;</div><div class="line">    *p_count = count;</div><div class="line">    </div><div class="line">    return 0;</div><div class="line">}</div><div class="line"></div><div class="line">int main()</div><div class="line">{</div><div class="line">    MP4Parser mp4Parser;</div><div class="line">    int count = 0;</div><div class="line">    </div><div class="line">    mp4Parser.parse(&quot;/your/mp4file/path/file.mp4&quot;);</div><div class="line">    mp4Parser.transfer(TransferFunc, &amp;count);</div><div class="line">    cout &lt;&lt; &quot;Moov box count:&quot; &lt;&lt; count &lt;&lt; endl;        </div><div class="line">}</div></div><!-- fragment --><p> <b>2. Find your intersted box:</b> </p><div class="fragment"><div class="line">int main()</div><div class="line">{</div><div class="line">    MP4Parser mp4Parser;</div><div class="line">    BoxPtr_t trakBox;</div><div class="line">    int trakCount = 0;        </div><div class="line">    </div><div class="line">    mp4Parser.parse(&quot;/your/mp4file/path/file.mp4&quot;);</div><div class="line"></div><div class="line">    trakCount = mp4Parser.getBoxCount(&quot;trak&quot;);</div><div class="line">    cout &lt;&lt; &quot;There are &quot; &lt;&lt; trakCount &lt;&lt; &quot; tracks.&quot; &lt;&lt; endl;</div><div class="line">    </div><div class="line">    trakBox = mp4Parser.getBox(&quot;trak&quot;);</div><div class="line">    while (trakBox)</div><div class="line">    {</div><div class="line">        BoxPtr_t tkhdBox = trakBox-&gt;findBoxInChildren(&quot;tkhd&quot;);</div><div class="line">        if (tkhdBox)</div><div class="line">        {</div><div class="line">            TkhdBoxPtr_t tkhdBoxPtr = std::dynamic_pointer_cast&lt;TkhdBox&gt;(tkhdBox);</div><div class="line">            cout &lt;&lt; &quot;Track ID:&quot; &lt;&lt; tkhdBoxPtr-&gt;trackID() &lt;&lt; endl;</div><div class="line">            cout &lt;&lt; &quot;    Duration:&quot; &lt;&lt; tkhdBoxPtr-&gt;duration() &lt;&lt; endl;</div><div class="line">        }</div><div class="line"></div><div class="line">        BoxPtr_t hdlrBox = trakBox-&gt;findBoxInChildren(&quot;hdlr&quot;);</div><div class="line">        if (tkhdBox)</div><div class="line">        {</div><div class="line">            HdlrBoxPtr_t hdlrBoxPtr = std::dynamic_pointer_cast&lt;HdlrBox&gt;(hdlrBox);</div><div class="line">            uint32_t hdlrType = hdlrBoxPtr-&gt;handlerType();</div><div class="line">            cout &lt;&lt; &quot;    Handler type:&quot; &lt;&lt; HdlrBox::HANDLER_TYPE_MAP[(HandlerType_e)hdlrType].c_str()</div><div class="line">             &lt;&lt; &quot;(0x&quot; &lt;&lt; hex &lt;&lt; uppercase &lt;&lt; hdlrType &lt;&lt; &quot;)&quot; &lt;&lt; dec &lt;&lt; endl;</div><div class="line">            cout &lt;&lt; &quot;    Handler Name:&quot; &lt;&lt; hdlrBoxPtr-&gt;name() &lt;&lt; endl;</div><div class="line">        }   </div><div class="line"></div><div class="line">        BoxPtr_t mdhdBox = trakBox-&gt;findBoxInChildren(&quot;mdhd&quot;);</div><div class="line">        if (mdhdBox)</div><div class="line">        {</div><div class="line">            MdhdBoxPtr_t mdhdBoxPtr = std::dynamic_pointer_cast&lt;MdhdBox&gt;(mdhdBox);</div><div class="line">            cout &lt;&lt; &quot;    Language:&#39;&quot; &lt;&lt; mdhdBoxPtr-&gt;language() &lt;&lt; &quot;&#39;&quot; &lt;&lt; endl;</div><div class="line">        }</div><div class="line"></div><div class="line">        trakBox = mp4Parser.getNextBox(trakBox);</div><div class="line">    }</div><div class="line"></div><div class="line">    return 0;</div><div class="line">}</div></div><!-- fragment --><p> <b>3. Output box information:</b> </p><div class="fragment"><div class="line">int main()</div><div class="line">{</div><div class="line">    MP4Parser mp4Parser;</div><div class="line">    BoxPtr_t trakBox;       </div><div class="line">    </div><div class="line">    mp4Parser.parse(&quot;/your/mp4file/path/file.mp4&quot;); </div><div class="line">    mp4Parser.outputBoxList();//Output to the stdout.</div><div class="line">    </div><div class="line">    mp4Parser.setDstFile(&quot;/your/resultfile/path/resut.txt&quot;);</div><div class="line">    mp4Parser.outputBoxList();//Output to a file.</div><div class="line">    </div><div class="line">    mp4Parser.redirectOut2File();</div><div class="line">    cout &lt;&lt; &quot;This line will be written into the result file.&quot; &lt;&lt; endl;</div><div class="line">    mp4Parser.outputBoxList();//Output to a file.</div><div class="line"></div><div class="line">    mp4Parser.restore2Stdout();</div><div class="line">    cout &lt;&lt; &quot;This line will not be written into the result file.&quot; &lt;&lt; endl;</div><div class="line">    </div><div class="line">    mp4Parser.setDstFile(&quot;&quot;);</div><div class="line">    mp4Parser.outputBoxList();//Output to the stdout again.        </div><div class="line">}</div></div><!-- fragment --><p> <b>4. Add new box:</b></p>
<p>(1).Add a new box class, if it is a container box, then inherits from class BoxContainer, or else inherits from class Box.</p>
<p>(2).Implement the virtual function parseBody() and showBody().</p>
<p>(3).Implment other private function of its own.</p>
<p>(4).Add new box name variable to BoxFactory class in <a class="el" href="boxfactory_8h_source.html">boxfactory.h</a>, for example: static const char* NEW_BOX;</p>
<p>(5).Implement the new box name in BoxFactory class in boxfactory.cpp, for example: const char* BoxFactory::FREE_BOX = "new_box";</p>
<p>(6).Return a new object from createBox() when use the new box name to create it. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
